<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Dojo Bites</title>
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script> -->
    <script src="../../static/dojobites_app/js/jquery-3.1.1.min.js"></script>
    {% load staticfiles %}
    <link rel="stylesheet" href="{% static 'dojobites_app/css/styles.css' %}" media="screen">
    <link rel="icon" href="{% static 'dojobites_app/images/favicon.ico' %}">
    <script>
        $(document).ready(function() {
            $('input#date').change(function() {
                var date = $(this).val();
                if(date)  update_date();
                else  $('div#results').html('');
            })
            $('div#results').on('change', 'select#rest', function() {
                var choice = $(this).val();
                if(choice) {
                    $.ajax({
                        method : 'post',
                        url : $('form#choice').attr('action'),  // '/bites/show/restaurant'
                        data : $('form#choice').serialize(),
                        success : function(resp){
                                      $('div#user').html(resp);
                                  }
                    })
                }
                else  update_date();
            })
            $('div#results').on('click', 'button', function() {
                var choice_id =  $(this).attr("title");
                var url = "/bites/join/"+choice_id;
                console.log("URL:", url);
                $.ajax({
                    method : 'get',
                    url : url,
                    success : function(resp){
                                console.log("Response:", resp);
                              }
                })
                update_date();
            })
            function update_date() {
                $.ajax({
                    method : 'post',
                    url : $('form#date').attr('action'),  // '/bites/show/choice'
                    data : $('form#date').serialize(),
                    success : function(resp){
                        $('div#results').html(resp);
                    }
                })
            }
        })
    </script>
  </head>
  <body>
      <div id="container">
        <header>
            <h1>Dojo Bites</h1>
            <div class="nav_bar">
                <h4><a href="{% url 'bites:index' %}">Where to Eat?</a></h4>
                <h4><a href="#">What's Nearby?</a></h4>
                <h4><a href="{% url 'bites:calendar' %}">My Calendar</a></h4>
                <h4><a href="{% url 'bites:profile' %}">My Profile</a></h4>
                <h4><a href="{% url 'bites:new' %}">Suggest a Restaurant</a></h4>
                <a href="{%url 'users:logout' %}"><button>Logout</button></a>
            </div>
        </header>
        {% if messages %}
        <ul class='messages'>
            {% for message in messages %}
                <li  {% if message.tags %}class="{{message.tags}}"{% endif %}>{{message}}</li>
            {% endfor %}
        </ul>
        {% endif %}
        <main>
            <h3>Join a group! {{ user.first_name|title }}</h3>
            <div id="voting">
                <div id="choice">
                    <form id="date" action="{% url 'bites:show_choice' %}" method="post"> {% csrf_token %}
                        <label>Select a Date:</label>
                        <input id="date" name="date" type="date">
                    </form>
                    <div id="results"></div>
                </div>
                <div id="comments">
                    <h3>Comments:</h3>
                    {% if not comments %}
                        <h5>Be the first to write a comment!</h5>
                    {% else %}
                        <ul class='comments'>
                        {% for comment in comments %}
                            <li class='comment'>{{comment.user.first_name}} says {{comment.content}}<br></li>
                        {% endfor %}
                        </ul>
                    {% endif %}
                    <form action="{% url 'bites:comment' %}" method="POST"> {% csrf_token %}
                        <input type="text" name="content">
                        <input type="submit" value="Submit">
                    </form>
                </div>
                <table>
                    <thead>
                        <th>Name:</th>
                        <th>Rating:</th>
                        <th>Location:</th>
                        <th>Actions:</th>
                    </thead>
                    {% if restaurants %}
                        {% for restaurant in restaurants %}
                            <tr>
                                <td><a href="{% url 'bites:details' restaurant.id %}">{{restaurant.name|title}}</a></td>
                                <td>{{restaurant.rating}}</td>
                                <td>{{restaurant.location|title}}</td>
                                <td><a href="{% url 'bites:join' %}">Join</a> <a href="{% url 'bites:unjoin' restaurant.id %}">Unjoin</a></td>
                            </tr>
                        {% endfor %}
                    {% endif%}
                </table>
            </div> <!-- end of voting -->
        </main> <!-- end main_content -->
    </div>
  </body>
</html>
